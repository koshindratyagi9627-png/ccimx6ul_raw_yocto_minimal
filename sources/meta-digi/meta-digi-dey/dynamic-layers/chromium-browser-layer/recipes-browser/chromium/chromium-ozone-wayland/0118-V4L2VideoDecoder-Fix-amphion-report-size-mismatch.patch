From 4ca9aa503552e9b052b85512e3d1fe24998de195 Mon Sep 17 00:00:00 2001
From: Hou Qi <qi.hou@nxp.com>
Date: Fri, 13 Sep 2024 23:23:56 +0900
Subject: [PATCH 18/19] V4L2VideoDecoder: Fix amphion report size mismatch

Upstream-Status: Inappropriate [NXP specific]
---
 media/gpu/v4l2/v4l2_video_decoder.cc | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/media/gpu/v4l2/v4l2_video_decoder.cc b/media/gpu/v4l2/v4l2_video_decoder.cc
index 4a2591f092f42..4c33ed4fea41f 100644
--- a/media/gpu/v4l2/v4l2_video_decoder.cc
+++ b/media/gpu/v4l2/v4l2_video_decoder.cc
@@ -736,7 +736,8 @@ CroStatus V4L2VideoDecoder::SetupOutputFormat(const gfx::Size& size,
       output_queue_->SetFormat(fourcc.ToV4L2PixFmt(), picked_size, 0);
   DCHECK(format);
   gfx::Size adjusted_size(format->fmt.pix_mp.width, format->fmt.pix_mp.height);
-  if (!gfx::Rect(adjusted_size).Contains(gfx::Rect(picked_size))) {
+  if (fourcc != std::optional<Fourcc>(Fourcc(Fourcc::NA12)) &&
+      !gfx::Rect(adjusted_size).Contains(gfx::Rect(picked_size))) {
     VLOGF(1) << "The adjusted coded size (" << adjusted_size.ToString()
              << ") should contains the original coded size("
              << picked_size.ToString() << ").";
-- 
2.34.1

